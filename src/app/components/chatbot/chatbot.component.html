<!-- src/app/components/chatbot/chatbot.component.html -->

<!-- Ícone do Chat (sempre visível) -->
<div class="chat-icon" (click)="openChat()" *ngIf="!chatVisible">
  <img src="assets/carton.jpg" alt="Jorge Vieira">
</div>

<!-- Chat Box -->
<div class="chat-box" *ngIf="chatVisible">
  <div class="chat-header">
    <div class="header-info">
      <img src="assets/carton.jpg" alt="Jorge Vieira" class="header-avatar">
      <div>
        <h3>JorgeAI</h3>
        <span class="status">Online</span>
      </div>
    </div>
    <button class="close-btn" (click)="chatVisible=false">
      <span>×</span>
    </button>
  </div>

  <div class="chat-body" #chatBody>
    <!-- Loop através de todas as mensagens -->
    <div *ngFor="let msg of messages"
         [ngClass]="msg.isBot ? 'message bot-message' : 'message user-message'">

      <!-- Avatar do bot (só para mensagens do bot) -->
      <div class="message-avatar" *ngIf="msg.isBot">
        <img src="assets/carton.jpg" alt="Bot">
      </div>

      <div class="message-content">
        <p [innerHTML]="formatMessage(msg.text)"></p>
        <span class="message-time">{{ msg.timestamp | date:'HH:mm' }}</span>
      </div>
    </div>

    <!-- Mensagens Predefinidas (aparecem no início) -->
    <div class="quick-replies" *ngIf="showQuickReplies && messages.length <= 1">
      <p class="quick-replies-title">Suggested questions:</p>
      <button
        *ngFor="let reply of quickReplies"
        class="quick-reply-btn"
        (click)="sendQuickReply(reply)">
        {{ reply }}
      </button>
    </div>

    <!-- Indicador "a digitar" -->
    <div class="message bot-message" *ngIf="isTyping">
      <div class="message-avatar">
        <img src="assets/carton.jpg" alt="Bot">
      </div>
      <div class="typing-indicator">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>



  <!-- FASE 2: Sugestões Detalhadas Colapsáveis (após primeira mensagem) -->
  <div class="suggestions-container" *ngIf="messages.length > 2">
    <button class="suggestions-toggle" (click)="toggleSuggestions()">
      <span class="toggle-icon">{{ showDetailedSuggestions ? '▼' : '▶' }}</span>
      <span class="toggle-text">More suggested questions</span>
      <span class="badge">{{ detailedSuggestions.length }}</span>
    </button>

    <div class="detailed-replies" *ngIf="showDetailedSuggestions">
      <button
        *ngFor="let reply of detailedSuggestions"
        class="quick-reply-btn"
        (click)="sendQuickReply(reply)">
        {{ reply }}
      </button>
    </div>
  </div>

  <button
    *ngIf="showScrollToLastMessage"
    class="scroll-to-last-message"
    (click)="scrollToLastMessage()"
    title="Ver última resposta">
    <span class="arrow">↑</span>
    <span class="text">View answer</span>
  </button>

  <div class="chat-footer">
    <input
      [(ngModel)]="question"
      placeholder="Type your message..."
      (keyup.enter)="askQuestion()"
      [disabled]="isTyping"
    />
    <button class="send-btn" (click)="askQuestion()" [disabled]="isTyping || !question.trim()">
      <span>➤</span>
    </button>
  </div>
</div>

